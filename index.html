<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <title>第1回 スターリーウィッシュ スコア試算ツール</title>
</head>

<body>
  <div class="w-full h-full bg-gray-200">
    <div class="max-w-[1100px]">
      <div class="mx-4 flex flex-col">
        <h1 class="text-3xl font-bold underline"> 第1回 スターリーウィッシュ スコア試算ツール </h1>
        <h1 class="text-3xl font-bold underline"> GFL2 The first Glittering Starwish Score Estimate Tool </h1>
        <div class="mt-10">
          <details class="cursor-pointer">
            <summary>注意事項 Attention</summary>
            <ul class="list-disc ml-5">
              <li>このツールはあくまで <b>試算</b> だよ。正確なスコアを計算するためのものじゃないよ。</li>
              <li>This tool calc <b>estimate score.</b> Not show exact score.</li>
              <li>ノリで急ぎ作ったから、間違っていても知らないよ。</li>
              <li>I don't guarantee calc result value.</li>
              <li>何回も手動で確定・やり直ししたスコアがバラバラのケースには対応してないよ</li>
              <li>Don't support multi score a day. Use max score only</li>
            </ul>
          </details>
        </div>

        <div class="bg-white rounded-sm mt-10 p-4">
          <div class="bg-gray-50 border-1 border-gray-100 rounded-md p-2">
            <div class="mb-4">
              <label for="before-day-total-penlight" class="block mb-2.5 text-sm font-medium text-heading">前日の累計助力
                What english "累計助力" ?, "Total PenLight" ? </label>
              <input type="number" id="before-day-total-penlight"
                class="bg-neutral-secondary-medium border border-default-medium text-heading text-sm rounded-base focus:ring-brand focus:border-brand block w-full px-3 py-2.5 shadow-xs placeholder:text-body"
                placeholder="650" required />
            </div>
            <div class="mb-4">
              <b for="before-day-total-score"
                class="block mb-2.5 text-sm font-medium text-heading"><b>前日までのペンライト獲得した分の</b>累計スコア
                The cumulative score of the penlights acquired up to the previous day</label>
                <input type="number" id="before-day-total-score"
                  class="bg-neutral-secondary-medium border border-default-medium text-heading text-sm rounded-base focus:ring-brand focus:border-brand block w-full px-3 py-2.5 shadow-xs placeholder:text-body"
                  placeholder="200000" required />
                <p>累計スコア報酬のペンライトを取得していない場合は0でOK</p>
            </div>
            <div class="mb-4">
              <label for="score" class="block mb-2.5 text-sm font-medium text-heading">今日のスコア Today Score</label>
              <input type="number" id="score"
                class="bg-neutral-secondary-medium border border-default-medium text-heading text-sm rounded-base focus:ring-brand focus:border-brand block w-full px-3 py-2.5 shadow-xs placeholder:text-body"
                placeholder="4800" required />
            </div>
            <div class="mb-4">
              <label for="play-num" class="block mb-2.5 text-sm font-medium text-heading">挑戦回数 Number of
                play</label>
              <input type="number" id="play-num"
                class="bg-neutral-secondary-medium border border-default-medium text-heading text-sm rounded-base focus:ring-brand focus:border-brand block w-full px-3 py-2.5 shadow-xs placeholder:text-body"
                placeholder="30" required />
            </div>
            <button id="calc-btn" value="day1"
              class="mb-4 w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
              計算する Calc
            </button>
            <p>本日の累計スコアなし獲得助力 Today PenLight without total bonus: <span id="without-total-score"></span></p>
            <p>前日の累計助力と合算 Sum yesterday PenLight: <span id="sum-without-total-score"></span></p>
            </br>
            <p>本日の累計スコアによる獲得助力 Today PenLight total bonus: <span id="total-score"></span></p>
            <p>本日の累計スコアあり獲得助力 Today PenLight with total bonus: <span id="with-total-score"></span></p>
            <p>前日の累計助力と合算 Sum yesterday PenLight: <span id="sum-with-total-score"></span></p>
          </div>
        </div>

      </div>
    </div>
  </div>
</body>

</html>


<script type="module">
  /** 累計スコアのペンライトがもらえる方のスコア報酬 */
  const TOTAL_SCORE_BONUS = [
    { TOTAL_SCORE: 900, PEN_LIGHT: 40 },
    { TOTAL_SCORE: 1_800, PEN_LIGHT: 40 },
    { TOTAL_SCORE: 2_700, PEN_LIGHT: 40 },
    { TOTAL_SCORE: 4_500, PEN_LIGHT: 100 },
    { TOTAL_SCORE: 9_000, PEN_LIGHT: 100 },
    { TOTAL_SCORE: 15_000, PEN_LIGHT: 100 },
    { TOTAL_SCORE: 24_000, PEN_LIGHT: 100 },
    { TOTAL_SCORE: 36_000, PEN_LIGHT: 100 },
    { TOTAL_SCORE: 45_000, PEN_LIGHT: 160 },
    { TOTAL_SCORE: 60_000, PEN_LIGHT: 160 },
    { TOTAL_SCORE: 72_000, PEN_LIGHT: 160 },
    { TOTAL_SCORE: 90_000, PEN_LIGHT: 160 },
    { TOTAL_SCORE: 126_000, PEN_LIGHT: 200 },
    { TOTAL_SCORE: 180_000, PEN_LIGHT: 200 },
    { TOTAL_SCORE: 240_000, PEN_LIGHT: 200 },
    { TOTAL_SCORE: 330_000, PEN_LIGHT: 200 },
    { TOTAL_SCORE: 375_000, PEN_LIGHT: 300 },
    { TOTAL_SCORE: 420_000, PEN_LIGHT: 300 },
    { TOTAL_SCORE: 480_000, PEN_LIGHT: 300 },
    { TOTAL_SCORE: 540_000, PEN_LIGHT: 300 },
    { TOTAL_SCORE: 600_000, PEN_LIGHT: 300 },
    { TOTAL_SCORE: 675_000, PEN_LIGHT: 300 },
    { TOTAL_SCORE: 788_000, PEN_LIGHT: 300 },
    { TOTAL_SCORE: 900_000, PEN_LIGHT: 300 },
    { TOTAL_SCORE: 1_050_000, PEN_LIGHT: 300 },
    { TOTAL_SCORE: 1_200_000, PEN_LIGHT: 300 },
    { TOTAL_SCORE: 1_350_000, PEN_LIGHT: 300 },
  ]

  /** 日あたりスコアともらえるペンライト。（多分ヒットしやすい）逆順で定義 */
  const DAILY_PEN_LIGHT_SCORES = [
    { SCORE: 3_800, PEN_LIGHT: 27 },
    { SCORE: 3_000, PEN_LIGHT: 22 },
    { SCORE: 2_400, PEN_LIGHT: 17 },
    { SCORE: 1_800, PEN_LIGHT: 12 },
    { SCORE: 1_200, PEN_LIGHT: 7 },
    { SCORE: 800, PEN_LIGHT: 4 },
    { SCORE: 400, PEN_LIGHT: 2 },
    { SCORE: 0, PEN_LIGHT: 1 },
  ]

  /** デイリー共有分スコア */
  const DAILY_SHARE_BONUS_SCORE = 10

  function handleCalc() {
    /** 画面入力値 */
    const beforeDayTotalPenLight = Number(document.getElementById("before-day-total-penlight").value)
    const beforeDayTotalScore = Number(document.getElementById("before-day-total-score").value)
    const todayScore = Number(document.getElementById("score").value)
    const playNum = Number(document.getElementById("play-num").value)

    /** 経験結果の出力先 HTMLElement 要素 */
    const withoutTotalScoreElm = document.getElementById("without-total-score")
    const sumWithoutTotalScoreElm = document.getElementById("sum-without-total-score")
    const totalScoreElm = document.getElementById("total-score")
    const withTotalScoreElm = document.getElementById("with-total-score")
    const sumWithTotalScoreElm = document.getElementById("sum-with-total-score")

    try {
      /** 4800以下のスコアで得られるペンライト */
      const todayPenLightBase = DAILY_PEN_LIGHT_SCORES.find((i) => i.SCORE <= todayScore).PEN_LIGHT
      /** 4880以上のスコアで得られるペンライト */
      const todayPenLightBonus = Math.floor((todayScore - 4800) / 80)
      /** 本日のペンライト（助力）の1回分 */
      const todayPenLightOnce = todayPenLightBase + (todayPenLightBonus > 0 ? todayPenLightBonus : 0)
      /** 本日のペンライト（助力）の合計 */
      const todayPenLight = todayPenLightOnce * playNum
      withoutTotalScoreElm.textContent = `${todayPenLight}`
      sumWithoutTotalScoreElm.textContent = `${beforeDayTotalPenLight + todayPenLight + DAILY_SHARE_BONUS_SCORE}`

      /** 未獲得の累計スコアによるペンライト一覧 */
      const unobtainedBonusPenLights = TOTAL_SCORE_BONUS.filter(v => v.TOTAL_SCORE > beforeDayTotalScore)
      /** 現在の累計スコア */
      const todayAddPrevDayScore = beforeDayTotalScore + todayScore * playNum
      /** 本日、獲得できる累計スコアによるペンライト一覧 */
      const todayCanGetBonusPenLight = unobtainedBonusPenLights.filter(v => v.TOTAL_SCORE < todayAddPrevDayScore).reduce((sum, item) => sum + item.PEN_LIGHT, 0)
      totalScoreElm.textContent = `${todayCanGetBonusPenLight}`
      withTotalScoreElm.textContent = `${todayPenLight + todayCanGetBonusPenLight}`
      sumWithTotalScoreElm.textContent = `${beforeDayTotalPenLight + todayPenLight + DAILY_SHARE_BONUS_SCORE + todayCanGetBonusPenLight}`

    } catch (error) {
      window.alert(`エラー。 ${error.name}, ${error.message}`);
    }
  }

  function init() {
    document
      .getElementById("calc-btn")
      .addEventListener("click", handleCalc);
  }
  init();

</script>
